# ğŸ“ Konfiguracja Google Drive dla nagraÅ„

## Krok 1: UtwÃ³rz projekt w Google Cloud Console

1. PrzejdÅº do https://console.cloud.google.com/
2. Kliknij "Select a project" â†’ "New Project"
3. Nazwa: **"CCDialer Recordings"**
4. Kliknij **"Create"**

## Krok 2: WÅ‚Ä…cz Google Drive API

1. W lewym menu wybierz **"APIs & Services"** â†’ **"Library"**
2. Wyszukaj: **"Google Drive API"**
3. Kliknij na wynik i naciÅ›nij **"Enable"**

## Krok 3: UtwÃ³rz OAuth 2.0 Credentials

### 3.1 Skonfiguruj OAuth Consent Screen

1. IdÅº do **"APIs & Services"** â†’ **"OAuth consent screen"**
2. Wybierz **"External"** â†’ **"Create"**
3. WypeÅ‚nij:
   - App name: `CCDialer Recordings`
   - User support email: `twoj@email.com`
   - Developer contact: `twoj@email.com`
4. Kliknij **"Save and Continue"**
5. W **Scopes** kliknij **"Add or Remove Scopes"**
6. Zaznacz:
   - `https://www.googleapis.com/auth/drive.file`
7. **"Save and Continue"** â†’ **"Save and Continue"** â†’ **"Back to Dashboard"**

### 3.2 UtwÃ³rz OAuth Client ID

1. IdÅº do **"APIs & Services"** â†’ **"Credentials"**
2. Kliknij **"Create Credentials"** â†’ **"OAuth client ID"**
3. Application type: **"Desktop app"**
4. Name: `CCDialer Desktop`
5. Kliknij **"Create"**
6. **ZAPISZ:**
   - `Client ID` (np. `123456-abc.apps.googleusercontent.com`)
   - `Client Secret` (np. `GOCSPX-abc123xyz`)

## Krok 4: Uzyskaj Refresh Token

### Metoda A: UÅ¼yj Google OAuth Playground (prostsze)

1. IdÅº do https://developers.google.com/oauthplayground/
2. Kliknij ikonÄ™ âš™ï¸ (Settings) w prawym gÃ³rnym rogu
3. Zaznacz **"Use your own OAuth credentials"**
4. Wklej:
   - OAuth Client ID: `[twÃ³j Client ID]`
   - OAuth Client secret: `[twÃ³j Client Secret]`
5. W lewym panelu wyszukaj: **"Drive API v3"**
6. Zaznacz: `https://www.googleapis.com/auth/drive.file`
7. Kliknij **"Authorize APIs"**
8. Wybierz swoje konto Google
9. Kliknij **"Allow"** (zezwÃ³l na dostÄ™p)
10. Kliknij **"Exchange authorization code for tokens"**
11. **ZAPISZ `Refresh token`** (np. `1//0gABCDEF...`)

### Metoda B: UÅ¼yj skryptu Node.js (zaawansowane)

```javascript
// get-refresh-token.js
const { google } = require('googleapis');
const readline = require('readline');

const CLIENT_ID = 'YOUR_CLIENT_ID';
const CLIENT_SECRET = 'YOUR_CLIENT_SECRET';
const REDIRECT_URI = 'urn:ietf:wg:oauth:2.0:oob';

const oauth2Client = new google.auth.OAuth2(
    CLIENT_ID,
    CLIENT_SECRET,
    REDIRECT_URI
);

const SCOPES = ['https://www.googleapis.com/auth/drive.file'];

const authUrl = oauth2Client.generateAuthUrl({
    access_type: 'offline',
    scope: SCOPES,
});

console.log('Authorize this app by visiting this url:', authUrl);

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout,
});

rl.question('Enter the code from that page here: ', async (code) => {
    rl.close();
    const { tokens } = await oauth2Client.getToken(code);
    console.log('Your refresh token:', tokens.refresh_token);
});
```

Uruchom:
```bash
npm install googleapis
node get-refresh-token.js
```

## Krok 5: UtwÃ³rz folder na Google Drive

1. OtwÃ³rz https://drive.google.com/
2. UtwÃ³rz nowy folder: **"CCDialer Recordings"**
3. Kliknij prawym przyciskiem â†’ **"Share"** â†’ **"Get link"**
4. URL bÄ™dzie wyglÄ…daÅ‚: `https://drive.google.com/drive/folders/1aBcDeFgHiJkLmNoPqRsTuVwXyZ`
5. **ZAPISZ folder ID** (czÄ™Å›Ä‡ po `/folders/`): `1aBcDeFgHiJkLmNoPqRsTuVwXyZ`

## Krok 6: Skonfiguruj zmienne Å›rodowiskowe

UtwÃ³rz plik `.env` w gÅ‚Ã³wnym katalogu projektu:

```bash
# Google Drive Configuration
GOOGLE_CLIENT_ID=123456-abc.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=GOCSPX-abc123xyz
GOOGLE_REFRESH_TOKEN=1//0gABCDEF...
GOOGLE_DRIVE_FOLDER_ID=1aBcDeFgHiJkLmNoPqRsTuVwXyZ
```

## Krok 7: Zainstaluj zaleÅ¼noÅ›ci

```bash
npm install googleapis dotenv
```

## Krok 8: Zaktualizuj recording-server.js

Na poczÄ…tku pliku dodaj:

```javascript
require('dotenv').config();
```

## Krok 9: Uruchom serwer

```bash
node recording-server.js
```

## Krok 10: Testowanie

1. Uruchom aplikacjÄ™ telefonu
2. Wybierz **"Google Drive"** jako miejsce zapisu
3. Nagraj testowÄ… rozmowÄ™
4. SprawdÅº Google Drive - nagranie powinno siÄ™ pojawiÄ‡ w folderze

---

## ğŸ”’ BezpieczeÅ„stwo

### âš ï¸ WAÅ»NE - Nigdy nie commituj do Git:
- `.env` - dodaj do `.gitignore`
- Client Secret
- Refresh Token

### PrzykÅ‚ad .gitignore:

```
# Environment
.env
.env.local

# Recordings
recordings/
*.webm
*.mp3
*.wav

# Credentials
credentials.json
token.json
```

---

## ğŸ”§ RozwiÄ…zywanie problemÃ³w

### Problem: "Invalid grant" error

**RozwiÄ…zanie:**
1. Refresh token wygasÅ‚
2. Wygeneruj nowy refresh token (Krok 4)
3. Upewnij siÄ™, Å¼e uÅ¼yÅ‚eÅ› `access_type: 'offline'`

### Problem: "Insufficient permissions"

**RozwiÄ…zanie:**
1. SprawdÅº czy zaznaczono prawidÅ‚owe scope: `drive.file`
2. Wygeneruj nowy refresh token z poprawnymi uprawnieniami

### Problem: "Quota exceeded"

**RozwiÄ…zanie:**
1. Google Drive API ma limity: 20,000 requests/day
2. Dla wiÄ™kszych potrzeb przenieÅ› siÄ™ na pÅ‚atny plan lub uÅ¼yj innej usÅ‚ugi

### Problem: Nagrania nie pojawiajÄ… siÄ™ na Google Drive

**RozwiÄ…zanie:**
1. SprawdÅº czy folder ID jest poprawny
2. Upewnij siÄ™, Å¼e folder ma odpowiednie uprawnienia
3. SprawdÅº logi serwera: `console.log` w recording-server.js

---

## ğŸ“Š Monitoring uploadÃ³w

### SprawdÅº status uploadÃ³w:

```bash
curl http://localhost:3003/api/statistics
```

### SprawdÅº listÄ™ nagraÅ„:

```bash
curl http://localhost:3003/api/recordings
```

---

## ğŸ’° Koszty

### Google Drive:
- **15 GB free** - wystarczy na ~2000 godzin nagraÅ„ (audio webm)
- **100 GB** - $1.99/miesiÄ…c
- **Unlimited** - Google Workspace ($6-18/user/miesiÄ…c)

### Oszacowanie:
- 1 minuta nagrania = ~450 KB
- 100 rozmÃ³w/dzieÅ„ Ã— 5 min = ~225 MB/dzieÅ„
- ~7 GB/miesiÄ…c = mieszczÄ… siÄ™ w darmowym limicie!

---

## âœ… Gotowe!

Twoje nagrania bÄ™dÄ… automatycznie zapisywane na Google Drive z:
- Automatycznym folderowaniem po datach
- Metadanymi (numer, nazwa, czas trwania)
- Bezpiecznym przechowywaniem w chmurze
- DostÄ™pem z dowolnego miejsca

---

## ğŸ”„ Alternatywy do Google Drive

JeÅ›li wolisz inne rozwiÄ…zanie:

### Dropbox
- API: https://www.dropbox.com/developers
- 2 GB free
- Prostsza konfiguracja niÅ¼ Google Drive

### OneDrive
- API: https://docs.microsoft.com/onedrive/developer/
- 5 GB free
- Integracja z Microsoft 365

### AWS S3
- Najbardziej profesjonalne
- Pay-as-you-go ($0.023/GB/miesiÄ…c)
- Nieograniczona skalowalnoÅ›Ä‡

### WÅ‚asny serwer
- PeÅ‚na kontrola
- Brak limitÃ³w
- Wymaga VPS (~$5-10/miesiÄ…c)
